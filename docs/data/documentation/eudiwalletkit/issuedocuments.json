{"metadata":{"title":"Issue documents","role":"article","roleHeading":"Article","modules":[{"name":"EudiWalletKit"}]},"hierarchy":{"paths":[["doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit"]]},"schemaVersion":{"major":0,"patch":0,"minor":3},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/IssueDocuments"},"sections":[],"abstract":[{"type":"text","text":"The library provides the functionality to issue documents using OpenID4VCI."}],"seeAlsoSections":[{"anchor":"Essentials","title":"Essentials","generated":true,"identifiers":["doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/GetStarted","doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/ManageDocuments","doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/SecureAreas","doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/PresentationService","doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/WalletUI"]}],"primaryContentSections":[{"kind":"content","content":[{"type":"heading","level":3,"anchor":"Overview","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"To issue a document"},{"type":"text","text":" "},{"type":"text","text":"using this functionality, EudiWallet must be property initialized."},{"type":"text","text":" "},{"type":"text","text":"If "},{"type":"reference","isActive":true,"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/EudiWallet\/userAuthenticationRequired"},{"type":"text","text":" is true, user authentication is required. The authentication prompt message has localisation key “issue_document”."},{"type":"text","text":" "},{"type":"text","text":"After issuing a document, the document data and corresponding private key are stored in the wallet storage."}]},{"type":"heading","level":3,"anchor":"Issue-document-by-docType","text":"Issue document by docType"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When the document docType to be issued use the "},{"code":"EudiWallet\/issueDocument(docTypeIdentifier:keyOptions:promptMessage:)","type":"codeVoice"},{"type":"text","text":" method."}]},{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Important Notes"}]},{"type":"text","text":":"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"For the ‘SecureEnclave’ secure area, only ES256 algorithm is supported for signing OpenId4CVI proof of possession of the"},{"type":"text","text":" "},{"type":"text","text":"public\/private key pair."}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The following example shows how to issue an EUDI Personal ID document using OpenID4VCI:"}]},{"type":"codeListing","syntax":"swift","code":["do {","\tlet keyOptions = try await wallet.getDefaultKeyOptions(.msoMdoc(\"org.iso.18013.5.1.mDL\"))","\tlet doc = try await userWallet.issueDocument(.msoMdoc(\"org.iso.18013.5.1.mDL\"), keyOptions: keyOptions","}","catch {","  \/\/ display error","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"You can also issue a document by passing a "},{"code":"configurationIdentifier","type":"codeVoice"},{"type":"text","text":" case. The configuration identifiers can be retrieved from the issuer’s metadata,  using the "},{"code":"getIssuerMetadata","type":"codeVoice"},{"type":"text","text":" method."}]},{"type":"codeListing","syntax":"swift","code":["  \/\/ get current issuer metadata","  let configuration = try await wallet.getIssuerMetadata()","  ...","  let doc = try await userWallet.issueDocument(.configurationIdentifier(\"eu.europa.ec.eudi.pid_vc_sd_jwt\"))"]},{"type":"heading","level":3,"anchor":"Resolving-Credential-offer","text":"Resolving Credential offer"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The library provides the "},{"code":"resolveOfferUrlDocTypes(uriOffer:)","type":"codeVoice"},{"type":"text","text":" method that resolves the credential offer URI."},{"type":"text","text":" "},{"type":"text","text":"The method returns the resolved "},{"code":"OfferedIssuanceModel","type":"codeVoice"},{"type":"text","text":" object that contains the offer’s data (offered document types, issuer name and transaction code specification for pre-authorized flow). The offer’s data can be displayed to the"},{"type":"text","text":" "},{"type":"text","text":"user."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The following example shows how to resolve a credential offer:"}]},{"type":"codeListing","syntax":"swift","code":[" func resolveOfferUrlDocTypes(uriOffer: String) async throws -> OfferedIssuanceModel {","    return try await wallet.resolveOfferUrlDocTypes(uriOffer: uriOffer)","  }"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"After user acceptance of the offer, the selected documents can be issued using the "},{"code":"issueDocumentsByOfferUrl(offerUri:docTypes:docTypeKeyOptions:txCodeValue:)","type":"codeVoice"},{"type":"text","text":" method."},{"type":"text","text":" "},{"type":"text","text":"The "},{"code":"txCodeValue","type":"codeVoice"},{"type":"text","text":" parameter is not used in the case of the authorization code flow."},{"type":"text","text":" "},{"type":"text","text":"The following example shows how to issue documents by offer URL:"}]},{"type":"codeListing","syntax":"swift","code":["\/\/ When resolving an offer, key options are now included","let offer = try await wallet.resolveOfferUrlDocTypes(uriOffer: offerUrl)","for docModel in offer.docModels {","  \/\/ use recommended key options or modify them","   let docTypes = offer.docModels.map { $0.copy(keyOptions: KeyOptions(credentialPolicy: .oneTimeUse, batchSize: 2))","   \/\/ Issue with optimal settings","   let newDocs = try await wallet.issueDocumentsByOfferUrl(offerUri: offerUrl, docTypes: docTypes, txCodeValue: txCode)","}"]},{"type":"heading","level":3,"anchor":"Authorization-code-flow","text":"Authorization code flow"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For the authorization code flow to work, the redirect URI must be specified specified by setting the the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/EudiWallet\/openID4VciConfig"},{"type":"text","text":" property."},{"type":"text","text":" "},{"type":"text","text":"The user is redirected in an authorization web view to the issuer’s authorization endpoint. After the user authenticates and authorizes the request, the issuer redirects the user back to the application with an authorization code. The library exchanges the authorization code for an access token and issues the document."}]},{"type":"heading","level":3,"anchor":"Pre-Authorization-code-flow","text":"Pre-Authorization code flow"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When Issuer supports the pre-authorization code flow, the resolved offer will also contain the corresponding"},{"type":"text","text":" "},{"type":"text","text":"information. Specifically, the "},{"code":"txCodeSpec","type":"codeVoice"},{"type":"text","text":" field in the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/OfferedIssuanceModel"},{"type":"text","text":" object will contain:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The input mode, whether it is NUMERIC or TEXT"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The expected length of the input"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The description of the input"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"From the user’s perspective, the application must provide a way to input the transaction code."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"After user acceptance of the offer, the selected documents can be issued using the "},{"code":"EudiWallet\/issueDocumentsByOfferUrl(offerUri:docTypes:txCodeValue:promptMessage:useSecureEnclave:claimSet:)","type":"codeVoice"},{"type":"text","text":" method."},{"type":"text","text":" "},{"type":"text","text":"When the transaction code is provided, the issuance process can be resumed by calling the above-mentioned method and passing the transaction code in the "},{"code":"txCodeValue","type":"codeVoice"},{"type":"text","text":" parameter."}]},{"type":"heading","level":3,"anchor":"Dynamic-issuance","text":"Dynamic issuance"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Wallet kit supports the Dynamic "},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/eu-digital-identity-wallet\/eudi-wallet-product-roadmap\/issues\/82"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"After calling "},{"code":"EudiWallet\/issueDocument(docType:scope:identifier:keyOptions:promptMessage:)","type":"codeVoice"},{"type":"text","text":" or "},{"code":"EudiWallet\/issueDocumentsByOfferUrl(offerUri:docTypes:docTypeKeyOptions:txCodeValue:promptMessage:claimSet:)","type":"codeVoice"},{"type":"text","text":" the wallet application need to check if the doc is pending and has a "},{"code":"authorizePresentationUrl","type":"codeVoice"},{"type":"text","text":" property. If the property is present, the application should perform the OpenID4VP presentation using the presentation URL. On success, the "},{"code":"EudiWallet\/resumePendingIssuance(pendingDoc:webUrl:)","type":"codeVoice"},{"type":"text","text":" method should be called with the authorization URL provided by the server."}]},{"type":"codeListing","syntax":"swift","code":["if let urlString = newDocs.last?.authorizePresentationUrl { ","\t\/\/ perform openid4vp presentation using the urlString ","\t\/\/ on success call resumePendingIssuance using the authorization url  "]}]}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/eudiwalletkit\/issuedocuments"]}],"kind":"article","references":{"doc://EudiWalletKit/documentation/EudiWalletKit/OfferedIssuanceModel":{"title":"OfferedIssuanceModel","navigatorTitle":[{"text":"OfferedIssuanceModel","kind":"identifier"}],"kind":"symbol","role":"symbol","type":"topic","url":"\/documentation\/eudiwalletkit\/offeredissuancemodel","abstract":[{"text":"Offered issue model contains information gathered by resolving an issue offer URL.","type":"text"}],"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/OfferedIssuanceModel","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"OfferedIssuanceModel","kind":"identifier"}]},"https://github.com/eu-digital-identity-wallet/eudi-wallet-product-roadmap/issues/82":{"titleInlineContent":[{"type":"text","text":"PID based issuance"}],"identifier":"https:\/\/github.com\/eu-digital-identity-wallet\/eudi-wallet-product-roadmap\/issues\/82","type":"link","title":"PID based issuance","url":"https:\/\/github.com\/eu-digital-identity-wallet\/eudi-wallet-product-roadmap\/issues\/82"},"doc://EudiWalletKit/documentation/EudiWalletKit/PresentationService":{"title":"Presentation Service","kind":"article","role":"article","type":"topic","url":"\/documentation\/eudiwalletkit\/presentationservice","abstract":[{"text":"The library supports document presentation via BLE or online verifier","type":"text"}],"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/PresentationService"},"doc://EudiWalletKit/documentation/EudiWalletKit/ManageDocuments":{"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/ManageDocuments","kind":"article","title":"Manage documents","type":"topic","url":"\/documentation\/eudiwalletkit\/managedocuments","abstract":[{"type":"text","text":"The EudiWallet class provides a set of methods to work with documents."}],"role":"article"},"doc://EudiWalletKit/documentation/EudiWalletKit/EudiWallet/openID4VciConfig":{"role":"symbol","fragments":[{"text":"var","kind":"keyword"},{"text":" ","kind":"text"},{"text":"openID4VciConfig","kind":"identifier"},{"text":": ","kind":"text"},{"preciseIdentifier":"s:13EudiWalletKit23OpenId4VCIConfigurationV","text":"OpenId4VCIConfiguration","kind":"typeIdentifier"}],"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/EudiWallet\/openID4VciConfig","type":"topic","abstract":[{"type":"text","text":"OpenID4VCI issuer parameters"}],"url":"\/documentation\/eudiwalletkit\/eudiwallet\/openid4vciconfig","title":"openID4VciConfig","kind":"symbol"},"doc://EudiWalletKit/documentation/EudiWalletKit/WalletUI":{"title":"EUDI iOS Wallet reference implementation","kind":"article","role":"sampleCode","type":"topic","url":"\/documentation\/eudiwalletkit\/walletui","abstract":[],"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/WalletUI"},"doc://EudiWalletKit/documentation/EudiWalletKit/GetStarted":{"title":"Get started","kind":"article","role":"article","type":"topic","url":"\/documentation\/eudiwalletkit\/getstarted","abstract":[{"text":"How to install and initialize EUDI Wallet Kit in your project","type":"text"}],"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/GetStarted"},"doc://EudiWalletKit/documentation/EudiWalletKit/SecureAreas":{"title":"Custom key management","kind":"article","role":"article","type":"topic","url":"\/documentation\/eudiwalletkit\/secureareas","abstract":[{"text":"Eudi Wallet Kit supports custom key management through the implementation of SecureArea and SecureKeyStorage protocols. This document details the process of integrating custom key management with the library.","type":"text"}],"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/SecureAreas"},"doc://EudiWalletKit/documentation/EudiWalletKit/EudiWallet/userAuthenticationRequired":{"role":"symbol","fragments":[{"text":"var","kind":"keyword"},{"kind":"text","text":" "},{"text":"userAuthenticationRequired","kind":"identifier"},{"kind":"text","text":": "},{"preciseIdentifier":"s:Sb","kind":"typeIdentifier","text":"Bool"}],"abstract":[{"text":"Whether user authentication via biometrics or passcode is required before sending user data","type":"text"}],"type":"topic","identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/EudiWallet\/userAuthenticationRequired","url":"\/documentation\/eudiwalletkit\/eudiwallet\/userauthenticationrequired","title":"userAuthenticationRequired","kind":"symbol"},"doc://EudiWalletKit/documentation/EudiWalletKit":{"role":"collection","abstract":[{"text":"EUDI Wallet Kit library for iOS","type":"text"}],"type":"topic","identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit","url":"\/documentation\/eudiwalletkit","title":"EudiWalletKit","kind":"symbol"}}}