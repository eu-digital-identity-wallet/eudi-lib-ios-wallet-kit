{"metadata":{"role":"article","title":"Custom key management","roleHeading":"Article","modules":[{"name":"EudiWalletKit"}]},"kind":"article","primaryContentSections":[{"content":[{"level":3,"type":"heading","anchor":"Secure-areas","text":"Secure areas"},{"inlineContent":[{"text":"The wallet developer can customize cryptographic key operations by passing ","type":"text"},{"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securearea","isActive":true,"type":"reference"},{"text":" instances to the wallet. In the absence of custom instances, the wallet kit automatically generates ","type":"text"},{"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-security\/documentation\/mdocsecurity18013\/secureenclavesecurearea","type":"reference","isActive":true},{"type":"text","text":" (default) and "},{"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-security\/documentation\/mdocsecurity18013\/softwaresecurearea","type":"reference","isActive":true},{"type":"text","text":" secure areas."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The secure area instance must be initialized with a secure key storage area implementing the "},{"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securekeystorage","isActive":true,"type":"reference"},{"text":" protocol. An iOS keychain-based storage is provided via the ","type":"text"},{"isActive":true,"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-wallet-storage\/documentation\/walletstorage\/keychainsecurekeystorage","type":"reference"},{"type":"text","text":" actor."}]},{"type":"paragraph","inlineContent":[{"text":"Assuming that the application developer has implemented the SecureArea protocol and registered an instance with the wallet kit, it will be available for custom secure area cryptographic operations. The following example demonstrates how to register a custom secure area with the Wallet Kit:","type":"text"}]},{"code":["let keyChainStorage = KeyChainSecureKeyStorage(serviceName: self.serviceName, accessGroup: nil)","let mySecureArea = MySecureArea(storage: keyChainStorage)","let wallet = try! EudiWallet(serviceName: \"wallet_dev_ui\",","\t\ttrustedReaderCertificates: [Data(name: \"eudi_pid_issuer_ut\", ext: \"der\")!],","\t\tsecureAreas: [mySecureArea])"],"type":"codeListing","syntax":"swift"},{"text":"Secure key creation on issuing","anchor":"Secure-key-creation-on-issuing","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"For each document type, the wallet developer has the flexibility to define specific key creation parameters, including the "},{"isActive":true,"type":"reference","identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securearea\/name-1uugf"},{"type":"text","text":", "},{"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/coseeccurve","isActive":true,"type":"reference"},{"type":"text","text":", "},{"type":"reference","identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/keyaccesscontrol","isActive":true},{"type":"text","text":" and "},{"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/keyaccessprotection","type":"reference","isActive":true},{"type":"text","text":"."}]},{"inlineContent":[{"type":"text","text":"Specifically:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"type":"reference","identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/EudiWallet\/issueDocument(docType:scope:identifier:keyOptions:promptMessage:)","isActive":true},{"type":"text","text":" has been extended to support an"},{"type":"text","text":" "},{"type":"text","text":"additional "},{"isActive":true,"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/keyoptions","type":"reference"},{"text":" optional parameter to specify the secure area name and other key options for the key creation.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/EudiWallet\/issueDocumentsByOfferUrl(offerUri:docTypes:docTypeKeyOptions:txCodeValue:promptMessage:claimSet:)","type":"reference","isActive":true},{"type":"text","text":" has been extended to support a "},{"code":"docTypeKeyOptions","type":"codeVoice"},{"text":" to specify the secure area name and other key options for each doc type.","type":"text"}]}]}]},{"code":["\/\/ For keychain saved keys, the iOS will automatically present a biometric or user PIN screen to authorize key usage for PID documents","let docTypeKeyOptions: [EuPidModel.euPidDocType : KeyOptions(secureAreaName: \"Software\", accessControl: [.requireUserPresence])]","let issuedDocs = try await wallet.issueDocumentsByOfferUrl(offerUri: uriOffered, docTypes: docIssueOffered.docModels, docTypeKeyOptions: docTypeKeyOptions)"],"type":"codeListing","syntax":"swift"},{"level":3,"text":"Secure key usage on presentation","type":"heading","anchor":"Secure-key-usage-on-presentation"},{"inlineContent":[{"text":"During presentation with BLE proximity or OpenID4VP, the private key is used to create a device signature. The secure area is automatically used to sign the device response. An unlock key hook is provided via the ","type":"text"},{"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securearea\/unlockkey(id:)-19q3g","isActive":true,"type":"reference"},{"text":" method which is internally called to get the optional ","type":"text"},{"type":"codeVoice","code":"unlockData"},{"type":"text","text":"."}],"type":"paragraph"}],"kind":"content"}],"hierarchy":{"paths":[["doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit"]]},"seeAlsoSections":[{"identifiers":["doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/GetStarted","doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/ManageDocuments","doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/IssueDocuments","doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/PresentationService","doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/WalletUI"],"generated":true,"title":"Essentials","anchor":"Essentials"}],"variants":[{"paths":["\/documentation\/eudiwalletkit\/secureareas"],"traits":[{"interfaceLanguage":"swift"}]}],"sections":[],"schemaVersion":{"minor":3,"patch":0,"major":0},"abstract":[{"type":"text","text":"Eudi Wallet Kit supports custom key management through the implementation of SecureArea and SecureKeyStorage protocols. This document details the process of integrating custom key management with the library."}],"identifier":{"url":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/SecureAreas","interfaceLanguage":"swift"},"references":{"doc://EudiWalletKit/documentation/EudiWalletKit/GetStarted":{"kind":"article","url":"\/documentation\/eudiwalletkit\/getstarted","abstract":[{"type":"text","text":"How to install and initialize EUDI Wallet Kit in your project"}],"role":"article","title":"Get started","type":"topic","identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/GetStarted"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-iso18013-data-model/documentation/mdocdatamodel18013/securearea":{"titleInlineContent":[{"text":"SecureArea","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securearea","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securearea","type":"link","title":"SecureArea"},"doc://EudiWalletKit/documentation/EudiWalletKit/PresentationService":{"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/PresentationService","role":"article","abstract":[{"type":"text","text":"The library supports document presentation via BLE or online verifier"}],"url":"\/documentation\/eudiwalletkit\/presentationservice","type":"topic","kind":"article","title":"Presentation Service"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-iso18013-data-model/documentation/mdocdatamodel18013/securearea/unlockkey(id:)-19q3g":{"titleInlineContent":[{"text":"unlockKey","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securearea\/unlockkey(id:)-19q3g","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securearea\/unlockkey(id:)-19q3g","type":"link","title":"unlockKey"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-iso18013-data-model/documentation/mdocdatamodel18013/securearea/name-1uugf":{"titleInlineContent":[{"text":"secure area name","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securearea\/name-1uugf","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securearea\/name-1uugf","type":"link","title":"secure area name"},"doc://EudiWalletKit/documentation/EudiWalletKit/IssueDocuments":{"kind":"article","url":"\/documentation\/eudiwalletkit\/issuedocuments","abstract":[{"type":"text","text":"The library provides the functionality to issue documents using OpenID4VCI."}],"role":"article","title":"Issue documents","type":"topic","identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/IssueDocuments"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-iso18013-security/documentation/mdocsecurity18013/secureenclavesecurearea":{"titleInlineContent":[{"text":"SecureEnclaveSecureArea","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-security\/documentation\/mdocsecurity18013\/secureenclavesecurearea","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-security\/documentation\/mdocsecurity18013\/secureenclavesecurearea","type":"link","title":"SecureEnclaveSecureArea"},"doc://EudiWalletKit/documentation/EudiWalletKit":{"url":"\/documentation\/eudiwalletkit","title":"EudiWalletKit","abstract":[{"type":"text","text":"EUDI Wallet Kit library for iOS"}],"type":"topic","kind":"symbol","role":"collection","identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit"},"doc://EudiWalletKit/documentation/EudiWalletKit/EudiWallet/issueDocumentsByOfferUrl(offerUri:docTypes:docTypeKeyOptions:txCodeValue:promptMessage:claimSet:)":{"url":"\/documentation\/eudiwalletkit\/eudiwallet\/issuedocumentsbyofferurl(offeruri:doctypes:doctypekeyoptions:txcodevalue:promptmessage:claimset:)","type":"topic","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"issueDocumentsByOfferUrl"},{"kind":"text","text":"("},{"kind":"externalParam","text":"offerUri"},{"text":": ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"},{"text":", ","kind":"text"},{"kind":"externalParam","text":"docTypes"},{"kind":"text","text":": ["},{"kind":"typeIdentifier","text":"OfferedDocModel","preciseIdentifier":"s:13EudiWalletKit15OfferedDocModelV"},{"kind":"text","text":"], "},{"kind":"externalParam","text":"docTypeKeyOptions"},{"kind":"text","text":": ["},{"text":"String","preciseIdentifier":"s:SS","kind":"typeIdentifier"},{"kind":"text","text":" : "},{"kind":"typeIdentifier","preciseIdentifier":"s:18MdocDataModel1801310KeyOptionsV","text":"KeyOptions"},{"kind":"text","text":"]?, "},{"kind":"externalParam","text":"txCodeValue"},{"kind":"text","text":": "},{"text":"String","kind":"typeIdentifier","preciseIdentifier":"s:SS"},{"text":"?, ","kind":"text"},{"kind":"externalParam","text":"promptMessage"},{"kind":"text","text":": "},{"text":"String","preciseIdentifier":"s:SS","kind":"typeIdentifier"},{"kind":"text","text":"?, "},{"text":"claimSet","kind":"externalParam"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"ClaimSet","preciseIdentifier":"s:10OpenID4VCI8ClaimSetO"},{"text":"?) ","kind":"text"},{"text":"async","kind":"keyword"},{"kind":"text","text":" "},{"text":"throws","kind":"keyword"},{"text":" -> [","kind":"text"},{"kind":"typeIdentifier","text":"Document","preciseIdentifier":"s:13WalletStorage8DocumentV"},{"kind":"text","text":"]"}],"kind":"symbol","title":"issueDocumentsByOfferUrl(offerUri:docTypes:docTypeKeyOptions:txCodeValue:promptMessage:claimSet:)","role":"symbol","abstract":[{"type":"text","text":"Issue documents by offer URI."}],"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/EudiWallet\/issueDocumentsByOfferUrl(offerUri:docTypes:docTypeKeyOptions:txCodeValue:promptMessage:claimSet:)"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-iso18013-data-model/documentation/mdocdatamodel18013/keyaccesscontrol":{"titleInlineContent":[{"text":"key access control","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/keyaccesscontrol","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/keyaccesscontrol","type":"link","title":"key access control"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-iso18013-data-model/documentation/mdocdatamodel18013/keyoptions":{"titleInlineContent":[{"text":"keyOptions","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/keyoptions","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/keyoptions","type":"link","title":"keyOptions"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-iso18013-data-model/documentation/mdocdatamodel18013/securekeystorage":{"titleInlineContent":[{"text":"SecureKeyStorage","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securekeystorage","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/securekeystorage","type":"link","title":"SecureKeyStorage"},"doc://EudiWalletKit/documentation/EudiWalletKit/EudiWallet/issueDocument(docType:scope:identifier:keyOptions:promptMessage:)":{"kind":"symbol","abstract":[{"type":"text","text":"Issue a document with the given docType using OpenId4Vci protocol"}],"fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"text":"issueDocument","kind":"identifier"},{"kind":"text","text":"("},{"text":"docType","kind":"externalParam"},{"kind":"text","text":": "},{"preciseIdentifier":"s:SS","kind":"typeIdentifier","text":"String"},{"kind":"text","text":"?, "},{"text":"scope","kind":"externalParam"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"},{"kind":"text","text":"?, "},{"kind":"externalParam","text":"identifier"},{"text":": ","kind":"text"},{"preciseIdentifier":"s:SS","kind":"typeIdentifier","text":"String"},{"kind":"text","text":"?, "},{"kind":"externalParam","text":"keyOptions"},{"text":": ","kind":"text"},{"kind":"typeIdentifier","text":"KeyOptions","preciseIdentifier":"s:18MdocDataModel1801310KeyOptionsV"},{"kind":"text","text":"?, "},{"kind":"externalParam","text":"promptMessage"},{"text":": ","kind":"text"},{"text":"String","kind":"typeIdentifier","preciseIdentifier":"s:SS"},{"text":"?) ","kind":"text"},{"text":"async","kind":"keyword"},{"kind":"text","text":" "},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:13WalletStorage8DocumentV","text":"Document"}],"url":"\/documentation\/eudiwalletkit\/eudiwallet\/issuedocument(doctype:scope:identifier:keyoptions:promptmessage:)","identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/EudiWallet\/issueDocument(docType:scope:identifier:keyOptions:promptMessage:)","title":"issueDocument(docType:scope:identifier:keyOptions:promptMessage:)","role":"symbol","type":"topic"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-wallet-storage/documentation/walletstorage/keychainsecurekeystorage":{"titleInlineContent":[{"text":"KeyChainSecureKeyStorage","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-wallet-storage\/documentation\/walletstorage\/keychainsecurekeystorage","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-wallet-storage\/documentation\/walletstorage\/keychainsecurekeystorage","type":"link","title":"KeyChainSecureKeyStorage"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-iso18013-data-model/documentation/mdocdatamodel18013/coseeccurve":{"titleInlineContent":[{"text":"curve type","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/coseeccurve","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/coseeccurve","type":"link","title":"curve type"},"doc://EudiWalletKit/documentation/EudiWalletKit/WalletUI":{"identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/WalletUI","title":"EUDI iOS Wallet reference implementation","role":"sampleCode","url":"\/documentation\/eudiwalletkit\/walletui","type":"topic","abstract":[],"kind":"article"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-iso18013-security/documentation/mdocsecurity18013/softwaresecurearea":{"titleInlineContent":[{"text":"SoftwareSecureArea","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-security\/documentation\/mdocsecurity18013\/softwaresecurearea","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-security\/documentation\/mdocsecurity18013\/softwaresecurearea","type":"link","title":"SoftwareSecureArea"},"https://eu-digital-identity-wallet.github.io/eudi-lib-ios-iso18013-data-model/documentation/mdocdatamodel18013/keyaccessprotection":{"titleInlineContent":[{"text":"key unlock policy","type":"text"}],"identifier":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/keyaccessprotection","url":"https:\/\/eu-digital-identity-wallet.github.io\/eudi-lib-ios-iso18013-data-model\/documentation\/mdocdatamodel18013\/keyaccessprotection","type":"link","title":"key unlock policy"},"doc://EudiWalletKit/documentation/EudiWalletKit/ManageDocuments":{"kind":"article","url":"\/documentation\/eudiwalletkit\/managedocuments","abstract":[{"type":"text","text":"The EudiWallet class provides a set of methods to work with documents."}],"role":"article","title":"Manage documents","type":"topic","identifier":"doc:\/\/EudiWalletKit\/documentation\/EudiWalletKit\/ManageDocuments"}}}